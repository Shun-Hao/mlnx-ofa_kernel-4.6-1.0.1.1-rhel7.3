From: Alaa Hleihel <alaa@mellanox.com>
Subject: [PATCH] BACKPORT:
 drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c

Change-Id: I46ccd1f6a813fdc5c56fde114749b99c3ecc1b1f
---
 drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c b/drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c
index xxxxxxx..xxxxxxx 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_fs_ethtool.c
@@ -367,6 +367,7 @@ static int set_flow_attrs(u32 *match_c, u32 *match_v,
 		return -EINVAL;
 	}
 
+#ifdef HAVE_ETHTOOL_FLOW_EXT_H_DEST
 	if ((fs->flow_type & FLOW_EXT) &&
 	    (fs->m_ext.vlan_tci & cpu_to_be16(VLAN_VID_MASK)))
 		set_cvlan(outer_headers_c, outer_headers_v, fs->h_ext.vlan_tci);
@@ -377,6 +378,7 @@ static int set_flow_attrs(u32 *match_c, u32 *match_v,
 		set_dmac(outer_headers_c, outer_headers_v, fs->m_ext.h_dest,
 			 fs->h_ext.h_dest);
 	}
+#endif
 
 	return 0;
 }
@@ -683,6 +685,7 @@ static int validate_flow(struct mlx5e_priv *priv,
 	default:
 		return -ENOTSUPP;
 	}
+#ifdef HAVE_ETHTOOL_FLOW_EXT_H_DEST
 	if ((fs->flow_type & FLOW_EXT)) {
 		ret = validate_vlan(fs);
 		if (ret < 0)
@@ -693,6 +696,7 @@ static int validate_flow(struct mlx5e_priv *priv,
 	if (fs->flow_type & FLOW_MAC_EXT &&
 	    !is_zero_ether_addr(fs->m_ext.h_dest))
 		num_tuples++;
+#endif
 
 	return num_tuples;
 }
@@ -838,7 +842,11 @@ int mlx5e_set_rxnfc(struct net_device *dev, struct ethtool_rxnfc *cmd)
 }
 
 int mlx5e_get_rxnfc(struct net_device *dev,
+#ifdef HAVE_ETHTOOL_OPS_GET_RXNFC_U32_RULE_LOCS
 		    struct ethtool_rxnfc *info, u32 *rule_locs)
+#else
+			   struct ethtool_rxnfc *info, void *rule_locs)
+#endif
 {
 	struct mlx5e_priv *priv = netdev_priv(dev);
 	int err = 0;
