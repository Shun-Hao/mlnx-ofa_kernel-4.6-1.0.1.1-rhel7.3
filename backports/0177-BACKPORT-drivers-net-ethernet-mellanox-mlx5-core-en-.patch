From: Talat Batheesh <talatb@mellanox.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/en/fs.h

Change-Id: I81c07abd550c9c718c5fd0f7a6b3396fd83afdb5
---
 drivers/net/ethernet/mellanox/mlx5/core/en/fs.h | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en/fs.h b/drivers/net/ethernet/mellanox/mlx5/core/en/fs.h
index xxxxxxx..xxxxxxx 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en/fs.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/fs.h
@@ -9,16 +9,20 @@ enum {
 	MLX5E_TC_TTC_FT_LEVEL,
 };
 
+#ifdef HAVE_TC_FLOWER_OFFLOAD
 struct mlx5e_tc_table {
 	struct mlx5_flow_table		*t;
 
 	struct rhashtable               ht;
 
+#ifdef HAVE_TCF_PEDIT_TCFP_KEYS_EX
 	DECLARE_HASHTABLE(mod_hdr_tbl, 8);
+#endif
 	DECLARE_HASHTABLE(hairpin_tbl, 8);
 
 	struct notifier_block     netdevice_nb;
 };
+#endif
 
 struct mlx5e_flow_table {
 	int num_groups;
@@ -36,9 +40,13 @@ struct mlx5e_l2_rule {
 struct mlx5e_vlan_table {
 	struct mlx5e_flow_table		ft;
 	DECLARE_BITMAP(active_cvlans, VLAN_N_VID);
+#ifdef HAVE_NETIF_F_HW_VLAN_STAG_RX
 	DECLARE_BITMAP(active_svlans, VLAN_N_VID);
+#endif
 	struct mlx5_flow_handle	*active_cvlans_rule[VLAN_N_VID];
+#ifdef HAVE_NETIF_F_HW_VLAN_STAG_RX
 	struct mlx5_flow_handle	*active_svlans_rule[VLAN_N_VID];
+#endif
 	struct mlx5_flow_handle	*untagged_rule;
 	struct mlx5_flow_handle	*any_cvlan_rule;
 	struct mlx5_flow_handle	*any_svlan_rule;
@@ -171,7 +179,9 @@ struct mlx5e_flow_steering {
 #ifdef CONFIG_MLX5_EN_RXNFC
 	struct mlx5e_ethtool_steering   ethtool;
 #endif
+#ifdef HAVE_TC_FLOWER_OFFLOAD
 	struct mlx5e_tc_table           tc;
+#endif
 	struct mlx5e_vlan_table         vlan;
 	struct mlx5e_l2_table           l2;
 	struct mlx5e_ttc_table          ttc;
